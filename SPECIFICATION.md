# 仕様書

## 1. 目的

ソースコードのレビュープロセスを支援し、開発者とレビュアー間のコミュニケーションを円滑にするためのWebアプリケーション。

## 2. 利用者

*   開発者: レビューを依頼する人。
*   レビュアー: ソースコードをレビューする人。

## 3. プラットフォーム

*   Webアプリケーション

## 4. 主な機能

### 4.1. レビュー依頼機能
*   開発者は、レビュー対象のソースコード（例: GitHubのPull Request URL）を指定してレビューを依頼できる。
*   依頼時に、複数のレビュアーを指名できる。
*   レビュー依頼は、複数の「ステージ」を持つことができる。

### 4.2. レビュー機能
*   依頼されたソースコードの差分を表示する（本プロトタイプではURLへのリンクのみ）。
*   レビュアーは、コードの特定の行に対してコメントを投稿できる（本プロトタイプではステージ全体へのコメント）。
*   レビュー依頼全体に対する一般的なコメントも投稿できる。

### 4.3. 状況管理機能
*   レビュアーは、自身のレビュー状況を以下のいずれかのステータスで更新できる。
    *   未着手 (`pending`)
    *   レビュー中 (`reviewing`)
    *   コメントあり (`commented`)
    *   承認 (`approved`)
*   レビュー依頼の詳細画面で、各レビュアーの状況を一覧表示する。

### 4.4. ダッシュボード機能
*   ユーザーが関わるレビュー依頼（自分が依頼したもの、自分が担当するもの）を一覧で表示する。

### 4.5. 複数段階レビュー
*   1つのレビュー依頼の中に、複数のレビュー段階（ステージ）を設定できる。
*   各ステージには、それぞれ異なるレビュアーを割り当てることができる。
*   コメントやレビュアーのステータスは、各ステージごとに管理される。
*   各ステージは独自のリポジトリURLを持つことができる。

## 5. 画面構成（日本語化・デザイン改善後）

### 5.1. ヘッダー
*   左側にアプリケーション名「レビュー管理」を表示。
*   右側に「レビュー一覧」「新規作成」ボタンを配置。

### 5.2. レビュー一覧画面 (`/`)
*   すべてのレビュー依頼をカード形式で一覧表示する。
*   各カードには、タイトル、依頼者、作成日時、レビュアーのアイコンを表示する。
*   カード全体が詳細ページへのリンクになっている。

### 5.3. レビュー依頼詳細画面 (`/reviews/:id`)
*   依頼のタイトル、依頼者、作成日時をカードヘッダーに表示する。
*   レビューのステージをタブで切り替えられるようにする。
*   各ステージについて、以下の情報を表示する。
    *   レビュアーとそのステータスの一覧。ステータスはドロップダウンで変更可能。
    *   コメントのスレッド。アイコン付きで誰のコメントか分かりやすく表示。
    *   コメント投稿フォーム。
*   情報はリアルタイムで更新される。

### 5.4. レビュー依頼作成画面 (`/new`)
*   レビューのタイトルを入力するフォーム。
*   レビューのステージを追加・編集・削除する機能。
    *   各ステージには、ステージ名とリポジトリURL、レビュアー（チェックボックスで複数選択）を指定する。
*   「レビュー依頼を作成」ボタンを押すと、依頼が作成され、詳細画面に遷移する。

## 6. データ構造とAPI

*   データモデル（型定義）は `app/src/types.ts` に集約。
*   データそのもの（ユーザーリストや初期レビュー依頼）は `app/src/data.ts` に定義。
*   APIエンドポイントは、Viteの開発サーバーのミドルウェアとして `app/vite.config.ts` 内に実装されている。これにより、フロントエンドとAPIが同一オリジンで動作する。
    *   `GET /api/reviews`
    *   `GET /api/reviews/:id`
    *   `POST /api/reviews`
    *   `PUT /api/reviews/:reviewId/stages/:stageId/assignments/:reviewerId`
    *   `POST /api/reviews/:reviewId/stages/:stageId/comments`

## 7. 認証

*   `vite.config.ts` 内のAPIミドルウェアで、`users[0]` を現在のユーザーとして設定することで、簡易的な認証をシミュレートしている。