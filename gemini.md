# Gemini CLI向けプロジェクト概要と開発ガイド

このドキュメントは、レビュー管理アプリケーションの現在の仕様と、Gemini CLIが開発を効率的に進めるために必要な主要な情報を提供します。

## 1. プロジェクト概要

このアプリケーションは、ソースコードのレビュープロセスを支援するためのWebアプリケーションです。開発者とレビュアー間のコミュニケーションを円滑にし、レビュー依頼の作成、管理、およびレビュー状況の追跡を可能にします。

## 2. アーキテクチャ

アプリケーションは、以下の3つの主要な層で構成され、それぞれが独立したDockerコンテナとして動作し、Docker Composeによって統合管理されます。

*   **フロントエンド (app)**: ReactとTypeScriptで構築されたシングルページアプリケーション(SPA)です。Viteをビルドツールおよび開発サーバーとして使用します。
*   **バックエンド (backend)**: Node.jsとExpress.js、TypeScriptで構築されたRESTful APIサーバーです。データベースとのやり取りを担当します。
*   **データベース (db)**: PostgreSQLを使用し、アプリケーションの全てのデータを永続化します。

## 3. 主要機能

*   **レビュー依頼の管理**: 開発者はレビュー依頼時に、レビュー対象のURL（GitHubのPull Requestなど）を指定できます。依頼時に複数のレビュアーを指名でき、レビュー依頼は複数の「ステージ」を持つことができます。レビュー依頼の作成、一覧表示、詳細表示、編集が可能です。
    *   **レビュアー割り当て支援**: 各ステージにレビュアー数を指定できます（デフォルトは3名）。指定した人数に基づき、全ユーザーからレビュアーをランダムに割り当てる機能や、ステージ1で指定したレビュアーを残り全てのステージに一括反映する機能があります。
    *   **Slack連携支援**: レビュー詳細画面の各ステージで、Slackへの投稿内容をクリップボードにコピーする機能があります。コピーされるテキストには、レビュー対象URL、レビュアーリスト（@ユーザー名 形式）、レビュー詳細ページのURLが含まれ、スムーズなレビュー依頼を支援します。
*   **レビューステータス管理**: レビュアーは自身のレビュー状況を `pending` (未着手), `commented` (コメントあり), `answered` (回答済み), `lgtm` (LGTM) のいずれかで更新可能です。レビュー依頼の詳細画面で、各レビュアーの状況を一覧表示します。
*   **コメント機能**: 各レビュー依頼のステージに対してコメントを投稿できます。コメントはスレッド形式で表示され、特定の行へのコメントや返信もサポートします。
*   **アクティビティログ**: レビュー依頼に関する主要なアクション（作成、ステータス変更、コメント追加など）を時系列で記録・表示します。誰が、いつ、どのようなアクションを行ったかを示します。
*   **ユーザー管理**: ユーザー（レビュアーや依頼者）の情報を管理します。ユーザーの新規作成、一覧取得、更新、削除が可能です。
*   **ステージテンプレート管理**: レビュー依頼作成時に利用できる、ステージ構成のテンプレートを管理します。テンプレートには、ステージ名、デフォルトのレビュアーリスト、レビュアー数が含まれます。テンプレートの作成、一覧取得、更新、削除が可能です。
    *   **デフォルトテンプレート**: 特定のテンプレートを「デフォルト」として設定できます。デフォルトに設定されたテンプレートは、レビュー依頼の新規作成時に自動的に読み込まれます。

## 4. 開発環境のセットアップと実行

プロジェクトを実行するには、DockerとDocker Composeが必要です。

1.  **Docker Desktopをインストールして起動します。**
2.  **プロジェクトの初回起動:** プロジェクトのルートディレクトリで、以下のコマンドを実行してコンテナをビルドし、起動します。
    ```bash
    docker-compose up --build
    ```
3.  **アプリケーションへのアクセス:** ブラウザで `http://localhost:5174` を開きます。
4.  **コンテナの停止:** ターミナルで `Ctrl + C` を押すとコンテナが停止します。
5.  **コンテナの完全な削除 (データベースリセットを含む):** データベースを含めて全てをクリーンな状態に戻したい場合は、以下のコマンドを実行します。
    ```bash
    docker-compose down -v
    ```

## 5. 重要なファイルとディレクトリ

*   `/app`: フロントエンドアプリケーションのソースコード。
    *   `app/src/pages/`: 各ページのReactコンポーネント（例: `ReviewList.tsx`, `MyReviews.tsx`, `UserManagement.tsx`など）。
    *   `app/src/components/`: 再利用可能なUIコンポーネント（例: `StatusSelector.tsx`）。
    *   `app/src/types.ts`: フロントエンドで使用される主要な型定義（`User`, `ReviewRequest`, `Comment`など）。
    *   `app/src/utils/api.ts`: API呼び出しに関するユーティリティ関数（例: `addAuthHeader`）。
    *   `app/src/index.css`: グローバルなスタイル定義。
    *   `app/vite.config.ts`: Viteの設定ファイル。APIプロキシ設定などが含まれます。
*   `/backend`: バックエンドAPIのソースコード。
    *   `backend/src/index.ts`: バックエンドアプリケーションのエントリーポイント。Expressサーバーの起動、ミドルウェアの設定、ルーティングのインポートを行います。
    *   `backend/src/db/index.ts`: データベース接続の確立と、`pool`オブジェクトのエクスポートを行います。
    *   `backend/src/routes/`: 各APIエンドポイントのルーティングロジックを分離したディレクトリ。
    *   `backend/src/routes/settings.ts`: グローバル設定の取得と更新に関するAPIエンドポイントを定義します。
    *   `backend/src/types.ts`: バックエンドで使用される主要な型定義。
*   `/db`: PostgreSQLデータベースの初期化スクリプト (`init.sql`) を含むディレクトリ。
*   `docker-compose.yml`: Docker Composeの設定ファイル。フロントエンド、バックエンド、データベースサービスの定義、ポートマッピング、ボリューム、ヘルスチェックなどが含まれます。
*   `init.sql`: PostgreSQLデータベースのスキーマ定義と初期データを含むSQLスクリプト。データベースの初回起動時に自動的に実行されます。
*   `package.json` (ルート、`app/`, `backend/`): 各プロジェクトの依存関係、スクリプト、メタデータ定義。
*   `.gitignore`: Gitがバージョン管理から除外すべきファイルやディレクトリ（例: `node_modules/`, ビルド成果物、環境変数ファイル）を指定します。
*   `.dockerignore` (`app/`, `backend/`): Dockerがイメージビルド時にコンテキストに含めるべきでないファイルやディレクトリを指定します。

## 6. リファクタリングの原則と規約

Gemini CLIがコードベースに変更を加える際の基本的な原則は以下の通りです。

*   **既存の規約の遵守**: コードスタイル、命名規則、ファイル構造など、既存のプロジェクトの規約を厳守します。
*   **関心の分離**: 各モジュールやコンポーネントが単一の責任を持つように設計します。
*   **再利用性**: 共通のロジックやUI要素は再利用可能な形で実装します。
*   **テスト可能性**: 変更がテストしやすいようにコードを構成します。
*   **明確なエラーハンドリング**: エラーは適切に捕捉され、ログに記録され、ユーザーにフィードバックされます。
*   **ドキュメントの更新**: コードの変更に合わせて、関連するドキュメント（`README.md`, `SPECIFICATION.md`, `DESIGN.md`）を常に最新の状態に保ちます。

## 7. 既知の課題と考慮事項

*   **認証シミュレーション**: 現在の認証は開発目的の簡易的なものです（`X-User-Id`ヘッダーを使用）。本番環境では、より堅牢な認証システムへの置き換えが必要です。
*   **`node_modules`の扱い**: DockerとNode.jsのボリュームマウントの特性上、`node_modules`はコンテナ内で`npm install`によって生成され、ホストのGitリポジトリからは`.gitignore`で除外されています。これにより、環境間の依存関係の問題を回避しています。
*   **データベースの初期化**: データベースのデータボリュームが存在する場合、`init.sql`は自動的に再実行されません。スキーマの変更を適用するには、`docker-compose down -v`でボリュームを削除してから再起動する必要があります。
*   **Slack連携**: 現在のSlack連携は、投稿用テキストのクリップボードコピー機能のみです。将来的には、API連携によるSlackへの直接投稿機能の実装が望まれます。

## 8. Gemini CLIの能力

私は以下のタスクを実行できます。

*   コードの読み込み、理解、説明
*   バグの特定と修正
*   新機能の追加
*   コードのリファクタリングと最適化
*   ドキュメントの作成と更新
*   テストの作成と実行
*   シェルコマンドの実行（ビルド、テスト、コンテナ操作など）
*   Git操作（ステージング、コミット、プッシュ）

何かご要望があれば、お気軽にお申し付けください。適化
*   ドキュメントの作成と更新
*   テストの作成と実行
*   シェルコマンドの実行（ビルド、テスト、コンテナ操作など）
*   Git操作（ステージング、コミット、プッシュ）

何かご要望があれば、お気軽にお申し付けください。